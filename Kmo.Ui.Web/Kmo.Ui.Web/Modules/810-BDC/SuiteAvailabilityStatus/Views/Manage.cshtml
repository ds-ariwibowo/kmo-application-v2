
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
    <h4 class="modal-title"><i class="icon-pencil font-dark"></i>&nbsp;<label id="titleModal" type="text" name="TitleModal" /> </h4>
    <div class="caption font-sm">
    </div>
</div>
        
    <div class="form-body">
        <div class="modal-body">

            <div class="portlet light bordered">
                <div class="portlet-body">

                    <table id="sas" class="dt-responsive" width="100%" hidden>
                        <tbody>
                            <tr>
                                <td>

                                    <div class="m-grid m-grid-responsive-xs m-grid-demo">
                                        <div class="m-grid-row">
                                            <div class="m-grid-col m-grid-col-middle m-grid-col-center m-grid-col-md-1 border-top border-left border-right border-bottom padding-left" style="background-color:white">
                                                <img alt="" class="img-responsive" src="~/Theme/assets/layouts/layout4/img/png.jpg" />
                                            </div>
                                            <div class="m-grid-col m-grid-col-top m-grid-col-center m-grid-col-md-3 border-top border-left border-right border-bottom padding-top padding-bottom"><h2><b>CFS</b></h2><p>Client Fact Sheet</p><hr /><b>No. : CFS-800-<label id="cfsNo" class="bold"></label></b></div>
                                            <div class="m-grid-col m-grid-col-top m-grid-col-center m-grid-col-md-1 border-top border-left border-right border-bottom padding-top padding-bottom padding-left">
                                               
                                              Date<hr />
                                               <input class="form-control responsive input-small bold center-align " size="14" type="text" value="" id="cfsdate" readonly />
                                                  
                                            </div>
                                            <div class="m-grid-col m-grid-col-top m-grid-col-center m-grid-col-md-1 border-top border-left border-right border-bottom padding-top padding-bottom">Document<hr />Revision<hr />Page</div>
                                            <div class="m-grid-col m-grid-col-top m-grid-col-center m-grid-col-md-1 border-top border-left border-right border-bottom padding-top padding-bottom">CFS-800<hr /><label id="rev"></label><hr />1 of 1</div>
                                        </div>

                                    </div>


                                    <h5><b> Test Repeater </b></h5>
                                    <div class="m-grid m-grid-responsive-md m-grid-demo">
                                        <div class="m-grid-row ">

                                            <div class="m-grid-col m-grid-col-middle m-grid-col-left m-grid-col-md-10 border-top border-left border-right border-bottom">
                                                
                                                <form action="#" class="mt-repeater form-horizontal">
                                                    <h3 class="mt-repeater-title">Human Resource Management</h3>
                                                    <div data-repeater-list="group-a">
                                                        <div data-repeater-item class="mt-repeater-item">
                                                            <!-- jQuery Repeater Container -->
                                                            <div class="mt-repeater-input">
                                                                <label class="control-label">Name</label>
                                                                <br />
                                                                <input type="text" name="text-input" class="form-control" value="John Smith" />
                                                            </div>
                                                            <div class="mt-repeater-input">
                                                                <label class="control-label">Joined Date</label>
                                                                <br />
                                                                <input class="input-group form-control form-control-inline date date-picker" size="16" type="text" value="01/08/2016" name="date-input" data-date-format="dd/mm/yyyy" />
                                                            </div>
                                                            <div class="mt-repeater-input mt-repeater-textarea">
                                                                <label class="control-label">Job Description</label>
                                                                <br />
                                                                <textarea name="textarea-input" class="form-control" rows="3">This role is to follow up with all meetings and ensure that each operational process flow moves accordingly in a timely manner.</textarea>
                                                            </div>
                                                            <div class="mt-repeater-input mt-radio-inline">
                                                                <label class="control-label">Tier</label>
                                                                <br />
                                                                <label class="mt-radio">
                                                                    <input type="radio" name="optionsRadios" id="optionsRadios25" value="junior" checked=""> Junior
                                                                    <span></span>
                                                                </label>
                                                                <label class="mt-radio">
                                                                    <input type="radio" name="optionsRadios" id="optionsRadios26" value="senior" checked=""> Senior
                                                                    <span></span>
                                                                </label>
                                                            </div>
                                                            <div class="mt-repeater-input mt-checkbox-inline">
                                                                <label class="control-label">Language</label>
                                                                <br />
                                                                <label class="mt-checkbox">
                                                                    <input type="checkbox" id="inlineCheckbox21" value="option1"> English
                                                                    <span></span>
                                                                </label>
                                                                <label class="mt-checkbox">
                                                                    <input type="checkbox" id="inlineCheckbox22" value="option2"> French
                                                                    <span></span>
                                                                </label>
                                                            </div>
                                                            <div class="mt-repeater-input">
                                                                <label class="control-label">Department</label>
                                                                <br />
                                                                <select name="select-input" class="form-control">
                                                                    <option value="A" selected>Marketing</option>
                                                                    <option value="B">Creative</option>
                                                                    <option value="C">Development</option>
                                                                </select>
                                                            </div>
                                                            <div class="mt-repeater-input">
                                                                <a href="javascript:;" data-repeater-delete class="btn btn-danger mt-repeater-delete">
                                                                    <i class="fa fa-close"></i> Delete
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <a href="javascript:;" data-repeater-create class="btn btn-success mt-repeater-add">
                                                        <i class="fa fa-plus"></i> Add
                                                    </a>
                                                </form>
                                               


                                            </div>
                                        </div>
                                    </div>                                   
                                      
                                </td>
                            </tr>
                        </tbody>
                    </table>
                  
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <label hidden id="newId" class="bold"></label>                  

            <button id="submit" type="submit" value="Save" class="btn green-soft">
                <i class="fa fa-check"></i> Submit
            </button>
            <button type="button" data-dismiss="modal" class="btn dark btn-outline"><i class="fa fa-close"></i> Cancel</button>

            <label hidden id="currentDate" class="bold">@DateTime.Now</label>            
           </div>
        </div>


<script src="~/Theme/assets/pages/scripts/components-date-time-pickers.min.js" type="text/javascript"></script>
<script src="~/Theme/assets/pages/scripts/form-validation-md.min.js" type="text/javascript"></script>


<script type="text/javascript">

    function formatCfs(value) {
        if (value !== '') {
            return value.substr(0, 2) + '-' + value.substr(2, 4) + '-' + value.substr(6, 4);
        }
    }

    function setCbValue(id, value) {
        document.getElementById(id).checked = value;
        document.getElementById(id).setAttribute("value", value);
        if (id == 'c65') {
            if (value == true)
                $('#c651').attr('readonly', false);
            else
            {
                $('#c651').attr('readonly', true);
                $('#c651').val("");
            }
        }
    }

    function parseJsonDate(jsonDate) {
        var fullDate = new Date(parseInt(jsonDate.substr(6)));
        var twoDigitMonth = (fullDate.getMonth() + 1) + ""; if (twoDigitMonth.length == 1) twoDigitMonth = "0" + twoDigitMonth;
        
        var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

        var twoDigitDate = fullDate.getDate() + ""; if (twoDigitDate.length == 1) twoDigitDate = "0" + twoDigitDate;
        //var currentDate = twoDigitMonth + "/" + twoDigitDate + "/" + fullDate.getFullYear();
        var currentDate = twoDigitDate + "-" + monthNames[fullDate.getMonth()] + "-" + fullDate.getFullYear();
        return currentDate;
    };
       

    var id = 0;
    $(document).ready(function () {
        App.startPageLoading({ animate: true });
        $('#cfs').show();
        var selectedId = document.getElementById("tempId").innerHTML;
        
        $.ajax({
            url: "/ClientFactSheet/GetCfs",
            data: { clientIssue: selectedId.substr(0, 2), clientId: selectedId.substr(2, 8) },
            type: 'Get',
            contentType: 'application/json',
            cache: false,
            success: function (e) {
                if (e.success) {
                    $.each(e.data, function (i, item) {
                        if (i == 'ClientId') {
                            $('#newId').text(item);
                        }
                        if (i == 'clientIssue') {
                            $('#newId').text(item$ + ('#newId').val().trim());
                            $('#cfsNo').text(formatCfs($('#newId').val().trim()));
                            $('#rev').text(parseInt(item) + 1);
                        }
                        if (i == 'Cid')
                            $('#cid').text(item);
                        if (i == 'CompanyName') {
                            document.getElementById("c1").setAttribute("value", item);
                            $("#c1").focus();
                        }
                        if (i == 'CompanyAddress')
                            document.getElementById("c2").value = item;
                        if (i == 'CompanyEmail')
                            document.getElementById("c7").setAttribute("value", item);
                        if (i == 'Npwp')
                            document.getElementById("c8").setAttribute("value", item);
                        if (i == 'City')
                            document.getElementById("c3").setAttribute("value", item);
                        if (i == 'ZipCode')
                            document.getElementById("c4").setAttribute("value", item);
                        if (i == 'Telephone')
                            document.getElementById("c5").setAttribute("value", item);
                        if (i == 'Fax')
                            document.getElementById("c6").setAttribute("value", item);
                        if (i == 'CreateDate')
                            //document.getElementById("cfsdate").setAttribute("value", parseJsonDate(item));
                            document.getElementById("cfsdate").value = parseJsonDate(item);
                        if (i == 'LineOfBusiness')
                            setLobValue(item);
                        if (i == 'LineOfBusinessOthersValue')
                            document.getElementById("c381").value = item;
                        if (i == 'RequiredSpaceArea')
                            document.getElementById("c41").setAttribute("value", item);
                        if (i == 'ProposedSuite')
                            document.getElementById("c42").setAttribute("value", item);
                        if (i == 'ProposedArea')
                            document.getElementById("c43").setAttribute("value", item);
                        if (i == 'RentStartingDate')
                            //document.getElementById("c44").setAttribute("value", parseJsonDate(item));
                            document.getElementById("c44").value = parseJsonDate(item);
                        if (i == 'RentPeriod')
                            document.getElementById("c45").setAttribute("value", item);
                        if (i == 'TotalReservedParkingCars')
                            document.getElementById("c51").setAttribute("value", item);
                        if (i == 'TotalUnReservedParkingCars')
                            document.getElementById("c52").setAttribute("value", item);
                        if (i == 'TotalParkingMotorbikes')
                            document.getElementById("c53").setAttribute("value", item);
                        if (i == 'RequiredTelephoneLines')
                            document.getElementById("c61").setAttribute("value", item);
                        if (i == 'IspFirstMedia')
                            setCbValue("c64", item);
                        if (i == 'IspExcelcomindo')
                            setCbValue("c62", item);
                        if (i == 'IspTelkom')
                            setCbValue("c63", item);
                        if (i == 'IspOthers')
                            setCbValue("c65", item);
                        if (i == 'IspOthersValue')
                            document.getElementById("c651").value = item;
                        if (i == 'RefKmoRentalSignage')
                            setCbValue("c71", item);
                        if (i == 'RefKmoWebsite')
                            setCbValue("c72", item);
                        if (i == 'RefNewspaper')
                            setCbValue("c73", item);
                        if (i == 'RefIndividual')
                            setCbValue("c74", item);
                        if (i == 'RefCompany')
                            setCbValue("c75", item);
                        if (i == 'RefOthers')
                            setCbValue("c76", item);
                        if (i == 'RefKmoRentalSignageValue')
                            document.getElementById("c711").setAttribute("value", item);
                        if (i == 'RefKmoWebsiteValue')
                            document.getElementById("c721").setAttribute("value", item);
                        if (i == 'RefNewspaperValue')
                            document.getElementById("c731").setAttribute("value", item);
                        if (i == 'RefIndividualValue')
                            document.getElementById("c741").setAttribute("value", item);
                        if (i == 'RefCompanyValue')
                            document.getElementById("c751").setAttribute("value", item);
                        if (i == 'RefOthersValue')
                            document.getElementById("c761").setAttribute("value", item);
                    });
                }
                else {
                    alert(e.message);
                }
            },
            complete: function () {},
            error: function (msg) {
                alert("something on CFS seems wrong");                
            }
        });

        $.ajax({
            url: "/ClientFactSheet/GetCfsPic",
            data: { clientIssue: selectedId.substr(0, 2), clientId: selectedId.substr(2, 8) },
            type: 'Get',
            contentType: 'application/json',
            cache: false,
            success: function (e) {
                if (e.success) {
                    $.each(e.data, function (i, item) {

                        $.each(item, function (col, value) {
                            var seqId = i + 1;
                            var nameId;
                            //alert('Row ' + seqId + 'Col ' + col + ' : ' + value);
                            if (JSON.parse(value.length != 0)) {
                                if (col == 'Name')
                                    nameId = 'c21' + seqId;
                                if (col == 'Position')
                                    nameId = 'c22' + seqId;
                                if (col == 'MobilePhone')
                                    nameId = 'c23' + seqId;
                                if (col == 'Email')
                                    nameId = 'c24' + seqId;
                                if ((col == 'Name') || (col == 'Position') || (col == 'MobilePhone') || (col == 'Email'))
                                    document.getElementById(nameId).setAttribute("value", value);
                            }

                        });
                    });
                }
                else {
                    alert(e.message);
                }
            },
            complete: function () {},
            error: function (msg) {
                alert("something on CFS PIC seems wrong");
            }
        });

        $.ajax({
            url: "/ClientFactSheet/GetCfsSpecialConditions",
            data: { clientIssue: selectedId.substr(0, 2), clientId: selectedId.substr(2, 8) },
            type: 'Get',
            contentType: 'application/json',
            cache: false,
            success: function (data) {
                $.each(data, function (i, item) {

                    $.each(item, function (col, value) {
                        var seqId = i + 1;
                        var nameId;
                        //alert('Row ' + seqId + 'Col ' + col + ' : ' + value);
                        if (JSON.parse(value.length != 0)) {
                            if (col == 'Conditions') {
                                nameId = 'c8' + seqId;
                                document.getElementById(nameId).setAttribute("value", value);
                            }
                        }

                    });
                });

            },
            complete: function () {},
            error: function (msg) {
                alert("something on CFS PIC seems wrong");
            }
        });
        App.stopPageLoading();
    });
       

    $("#submit").click(function () {

        if ($('#c1').val().trim() == '' || $('#c2').val().trim() == '' || $('#c7').val().trim() == '' || $('#c3').val().trim() == '' || $('#c4').val().trim() == '' || $('#c5').val().trim() == ''
            || $('#c211').val().trim() == '' || $('#c221').val().trim() == '' || $('#c231').val().trim() == '' || $('#c241').val().trim() == ''
            || $('#cfsdate').val().trim() == '') {
            if ($('#c241').val().trim() == '')
                $("#c241").focus();
            if ($('#c231').val().trim() == '')
                $("#c231").focus();
            if ($('#c221').val().trim() == '')
                $("#c221").focus();
            if ($('#c211').val().trim() == '')
                $("#c211").focus();
            if ($('#c8').val().trim() == '')
                $("#c8").focus();
            if ($('#c5').val().trim() == '')
                $("#c5").focus();
            if ($('#c4').val().trim() == '')
                $("#c4").focus();
            if ($('#c3').val().trim() == '')
                $("#c3").focus();
            if ($('#c7').val().trim() == '')
                $("#c7").focus();
            if ($('#c2').val().trim() == '')
                $("#c2").focus();
            if ($('#c1').val().trim() == '')
                $("#c1").focus();
            if ($('#cfsdate').val().trim() == '')
                $("#cfsdate").focus();
            return;
        }
        if ($('#c44').val().trim() == '') {
            $("#c44").focus();
            return;
        }

        var cfs = document.getElementById("newId").innerHTML;
        var cid = document.getElementById("cid").innerHTML;

        App.startPageLoading({ animate: true });

        var listPic = [];
        for (var i = 1; i <= 3; i++) {
            var nameId = 'c21' + i;
            var posId = 'c22' + i;
            var mobileId = 'c23' + i;
            var emailId = 'c24' + i;
            if (document.getElementById(nameId).value !== '') {
                var pic =
                {
                    ClientId: cfs.substr(2, 8),
                    ClientIssue: cfs.substr(0, 2),
                    HoldingCompanyId: $('#holdingCompanyId').val(),
                    ClientsPicID: i,
                    Name: document.getElementById(nameId).value,
                    Position: document.getElementById(posId).value,
                    MobilePhone: document.getElementById(mobileId).value,
                    Email: document.getElementById(emailId).value
                }
                listPic.push(pic);
            }
        }

        var listOfTerm = [];
        for (var i = 1; i <= 5; i++) {
            var conditionlId = 'c8' + i;
            if (document.getElementById(conditionlId).value !== '') {
                var term =
                {
                    ClientId: cfs.substr(2, 8),
                    ClientIssue: cfs.substr(0, 2),
                    HoldingCompanyId: $('#holdingCompanyId').val(),
                    ClientsSpecialConditionsId: i,
                    Conditions: document.getElementById(conditionlId).value
                }
                listOfTerm.push(term);
            }
        }

        var requiredSpaceArea = $('#c41').val();
        if (requiredSpaceArea.trim() == '')
            requiredSpaceArea = 0;
        var proposedSuite = $('#c42').val();
        if (proposedSuite.trim() == '')
            proposedSuite = '-';
        var proposedArea = $('#c43').val();
        if (proposedArea.trim() == '')
            proposedArea = 0;
        var rentPeriod = $('#c45').val();
        if (rentPeriod.trim() == '')
            rentPeriod = 0;
        var totalReservedParkingCars = $('#c51').val();
        if (totalReservedParkingCars.trim() == '')
            totalReservedParkingCars = 0;
        var totalUnReservedParkingCars = $('#c52').val();
        if (totalUnReservedParkingCars.trim() == '')
            totalUnReservedParkingCars = 0;
        var totalParkingMotorbikes = $('#c53').val();
        if (totalParkingMotorbikes.trim() == '')
            totalParkingMotorbikes = 0;
        var requiredTelephoneLines = $('#c61').val();
        if (requiredTelephoneLines.trim() == '')
            requiredTelephoneLines = 0;

        var model = {
            oldId: document.getElementById("tempId").innerHTML,
            ClientId: cfs.substr(2, 8),
            ClientIssue: cfs.substr(0, 2),
            HoldingCompanyId: $('#holdingCompanyId').val(),
            Cid: cid,
            CompanyName: $('#c1').val(),
            CompanyAddress: $('#c2').val(),
            CompanyEmail: $('#c7').val(),
            Npwp: $('#c8').val(),
            City: $('#c3').val(),
            ZipCode: $('#c4').val(),
            Telephone: $('#c5').val(),
            Fax: $('#c6').val(),
            CreateDate: document.getElementById("currentDate").innerHTML, //$('#cfsdate').val()
            LineOfBusiness: cid.substr(0, 2),
            LineOfBusinessOthersValue: $('#c381').val(),
            RequiredSpaceArea: requiredSpaceArea,
            ProposedSuite: proposedSuite,
            ProposedArea: proposedArea,
            RentStartingDate: $('#c44').val(),
            RentPeriod: rentPeriod,
            TotalReservedParkingCars: totalReservedParkingCars,
            TotalUnReservedParkingCars: totalUnReservedParkingCars,
            TotalParkingMotorbikes: totalParkingMotorbikes,
            RequiredTelephoneLines: requiredTelephoneLines,
            IspFIrstMedia: $('#c64').val(),
            IspExcelcomindo: $('#c62').val(),
            IspTelkom: $('#c63').val(),
            IspOthers: $('#c65').val(),
            IspOthersValue: $('#c651').val(),
            RefKmoRentalSignage: $('#c71').val(),
            RefKmoWebsite: $('#c72').val(),
            RefNewspaper: $('#c73').val(),
            RefIndividual: $('#c74').val(),
            RefCompany: $('#c75').val(),
            RefOthers: $('#c76').val(),
            RefKmoRentalSignageValue: $('#c711').val(),
            RefKmoWebsiteValue: $('#c721').val(),
            RefNewspaperValue: $('#c731').val(),
            RefIndividualValue: $('#c741').val(),
            RefCompanyValue: $('#c751').val(),
            RefOthersValue: $('#c761').val(),
            Status: "WIP",
            ta_CLIENTS_PICs: listPic,
            ta_CLIENTS_SpecialConditions: listOfTerm
        };

        $.ajax({
            type: "POST",
            data: JSON.stringify(model),
            url: "/ClientFactSheet/AddNewCfs",
            contentType: "application/json"
        }).done(function (res) {
            App.stopPageLoading();                
          
            window.location.reload(true);
        });
    });


</script>