
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
    <h4 class="modal-title"><i class="icon-pencil font-dark"></i>&nbsp;<label id="titleModal" type="text" name="TitleModal" /> </h4>
    <div class="caption font-sm">
    </div>
</div>
        
    <div class="form-body">
        <div class="modal-body">

            <div class="portlet light bordered">
                <div class="portlet-body">

                    <table id="ecd" class="dt-responsive" width="100%" hidden>
                        <tbody>
                            <tr>
                                <td>

                                    <div class="m-grid m-grid-responsive-xs m-grid-demo">
                                        <div class="m-grid-row">
                                            <div class="m-grid-col m-grid-col-middle m-grid-col-center m-grid-col-md-1 border-top border-left border-right border-bottom padding-left" style="background-color:white">
                                                <img alt="" class="img-responsive" src="~/Theme/assets/layouts/layout4/img/png.jpg" />
                                            </div>
                                            <div class="m-grid-col m-grid-col-top m-grid-col-center m-grid-col-md-3 border-top border-left border-right border-bottom padding-top padding-bottom"><h2><b>APA:ECD</b></h2><hr /><p>Account Payable : Electricity Consumption Distribution</p></div>
                                            <div class="m-grid-col m-grid-col-top m-grid-col-center m-grid-col-md-1 border-top border-left border-right border-bottom padding-top padding-bottom padding-left">

                                                Date<hr />
                                                <input class="form-control responsive input-small bold center-align " size="14" type="text" value="" id="ecddate" readonly />

                                            </div>
                                            <div class="m-grid-col m-grid-col-top m-grid-col-center m-grid-col-md-1 border-top border-left border-right border-bottom padding-top padding-bottom">Document<hr />Revision<hr />Page</div>
                                            <div class="m-grid-col m-grid-col-top m-grid-col-center m-grid-col-md-1 border-top border-left border-right border-bottom padding-top padding-bottom">APA:ECD-740<hr /><label id="rev"></label><hr />1</div>
                                        </div>
                                    </div>
                                    <br />
                                    <div class="m-grid m-grid-responsive-md m-grid-demo">
                                        <div class="m-grid-row">

                                            <div class="m-grid-col m-grid-col-top m-grid-col-left m-grid-col-md-1 border-top border-left border-right border-bottom padding-top padding-bottom padding-left padding-right">
                                                <div class="form-group form-md-line-input">
                                                    <input type="text" class="form-control date-picker bold" id="c2" name="name" placeholder="dd-MMM-yyyy" data-date-format="dd-M-yyyy">
                                                    <label for="form_control_1"><b>Submit Date</b></label>
                                                </div>
                                            </div>
                                            @*<div class="m-grid-col m-grid-col-top m-grid-col-left m-grid-col-md-1 border-top border-left border-right border-bottom padding-top padding-bottom padding-left padding-right">
                        <div class="form-group form-md-line-input">
                            <input type="text" class="form-control bold" id="c3" name="number" onblur="setValueCurr('#c3');"  placeholder="0" value="">
                            <label for="form_control_1"><b>Tenant Tariff (Rp/kWh)</b></label>
                        </div>
                    </div>*@
                                            <div class="m-grid-col m-grid-col-top m-grid-col-left m-grid-col-md-1 border-top border-left border-right border-bottom padding-top padding-bottom padding-left padding-right">
                                                <div class="form-group form-md-line-input">
                                                    <input type="text" class="form-control bold" id="c4" name="number" onblur="setValueCurr('#c4');" placeholder="0" value="">
                                                    <label for="form_control_1"><b>PLN's Total Bill (Rp)</b></label>
                                                </div>
                                            </div>
                                            @*<div class="m-grid-col m-grid-col-top m-grid-col-left m-grid-col-md-1 border-top border-left border-right border-bottom padding-left padding-right">
                        <div class="form-group form-md-line-input">

                            <input type="text" class="form-control" id="c5" readonly disabled placeholder="0" value="">
                            <label for="form_control_1"><b>Equivalent (kWh)</b></label>
                        </div>
                    </div>*@

                                        </div>
                                    </div>
                                    @*<div class="m-grid m-grid-responsive-md m-grid-demo">
                                        <div class="m-grid-row">

                                            <div class="m-grid-col m-grid-col-top m-grid-col-left m-grid-col-md-2 border-top border-left border-right border-bottom padding-top padding-bottom padding-left padding-right">
                                                <div class="form-group form-md-line-input">
                                                    <label for="form_control_1"><b>Note : Tenant Tariff (Rp/kWh) & ECD Usages (kWh) will be generated automatically when Calculated ! </b></label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>*@

                                </td>
                            </tr>
                        </tbody>
                    </table>
                  
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <label hidden id="currentDate" class="bold">@DateTime.Now.ToString("dd-MMM-yyyy")</label>   
            <label hidden id="user" class="bold">@User.Identity.Name</label>              
       

            <button id="submit" type="submit" value="Save" class="btn green-soft">
                <i class="fa fa-check"></i> Submit
            </button>
            <button type="button" data-dismiss="modal" class="btn dark btn-outline"><i class="fa fa-close"></i> Cancel</button>
                                      
           </div>
        </div>

<script src="~/Theme/assets/pages/scripts/components-date-time-pickers.min.js" type="text/javascript"></script>
<script src="~/Theme/assets/pages/scripts/form-validation-md.min.js" type="text/javascript"></script>


<script type="text/javascript">

    function parseToFloat(selectedId) {
        var id = '#' + $(selectedId).attr('id');
        if (id == '#undefined') {
            if (selectedId.substr(0, 1) !== '#')
                id = '#' + selectedId;
            else
                id = selectedId;
        }      
        $(id).val(parseFloat(Number($(id).val().toString().replace(/[^0-9\.]+/g, ""))));
    }

    function parseToNum(total) {
        return Number(total.toString().replace(/[^0-9\.]+/g, ""));
    }

    function formatCurrency(total) {
        var neg = false;
        if (total < 0) {
            neg = true;
            total = Math.abs(total);
        }
        var cur = (neg ? "-" : '') + parseFloat(total, 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString();
        return cur.substr(0, cur.length - 3);
    }

    function setValueCurr(id) {
        //format to currency (string)
        var curr = formatCurrency($(id).val());
        $(id).val(curr);
     
        //setValue(id);
    }


    //function setValue(selectedId) {
    //    var id = '#' + $(selectedId).attr('id');
    //    if (id == '#undefined') {
    //        if (selectedId.substr(0, 1) !== '#')
    //            id = '#' + selectedId;
    //        else
    //            id = selectedId;
    //    }

    //    var idLabel = '';
    //    idLabel = id.substr(0, 2);
     
    //    var i = parseToNum($(idLabel + '3').val());
    //    var i1 = parseToNum($(idLabel + '4').val());
     
    //    if ((i == 'isNan') || (i == ''))
    //        i = 0;
    //    if ((i1 == 'isNan') || (i1 == ''))
    //        i1 = 0;
       
    //    $(idLabel + '5').val(i1/i);
    //}

    
    //var FormInputMask = function () {
    //    var handleInputMasks = function () {
    //        $('#c5').inputmask('Regex', { regex: "^[0-9]{1,9}(\\.\\d{1,2})?$" });
    //    }
    //    return {
    //        init: function () {
    //            handleInputMasks();
    //        }
    //    };
    //}();
      

    var id = 0;
    $(document).ready(function () {
        App.startPageLoading({ animate: true });
        //FormInputMask.init();

        $('#ecd').show();
        $('#ecddate').val($('#currentDate').text());
     
        $('#c2').val($('#currentDate').text());
        //$('#c3').val(0);
        $('#c4').val(0);
        //$('#c5').val(0);
        $('#rev').text(1);
        App.stopPageLoading();
    });


    $("#submit").click(function () {

        if ($('#c4').val().trim() == '0') {
            $("#c4").focus();
            return;
        }
        //if ($('#c3').val().trim() == '0') {
        //    $("#c3").focus();
        //    return;
        //}
        if ($('#c2').val().trim() == '') {
            $("#c2").focus();
            return;
        } 
       
        App.startPageLoading({ animate: true });
     
        var model = {
            HoldingCompanyId: $('#holdingCompanyId').val(),
            Date: $('#c2').val(),
            TotalAmountEcd: parseToNum($('#c4').val()),
            TenantsTariffPerKWH: 0, //parseToNum($('#c3').val()),           
            //Usages: parseToNum($('#c5').val()),
            UsagesFloor: 0,
            UsagesSuite: 0,
            UsagesTotal: 0,
            UserId: $('#user').text(),
            datestamp: $('#currentDate').text()           
        };

        $.ajax({
            type: "POST",
            data: JSON.stringify(model),
            url: "/UtlEcd/SubmitUtlEcd",
            contentType: "application/json"
        }).done(function (res) {
            App.stopPageLoading();
            if (res.length > 0) {
                bootbox.alert(res);
                return;
            }
            window.location.reload(true);
        });
        
    });


</script>